<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml"> <head> <meta charset="utf-8"/> <title>Lichat-Protocol</title> <meta name="viewport" content="width=device-width"/> <meta name="description" content="The independent protocol part of Lichat."/> <meta name="author" content="Nicolas Hafner &lt;shinmera@tymoon.eu&gt;"/> <style type="text/css"> body{
          max-width: 1024px;
          margin: 0 auto 0 auto;
          font-family: sans-serif;
          color: #333333;
          font-size: 14pt;
          padding: 5px;
      }
      body>header{
          display:flex;
          align-items: center;
          justify-content: center;
          flex-direction: column;
          max-width: 100%;
          text-align: center;
      }
      body>header img{
          max-width: 50%;
      }
      img{
          max-width: 100%;
          max-height: 100%;
      }
      code{
          font-family: Consolas, Inconsolata, monospace;
      }
      a{
          text-decoration: none;
          color: #0055AA;
      }
      a img{
          border: none;
      }
      #documentation{
          text-align: justify;
      }
      #documentation pre{
          margin-left: 20px;
          overflow: auto;
      }
      #documentation img{
          margin: 5px;
      }
      #symbol-index>ul{
          list-style: none;
          padding: 0;
      }
      #symbol-index .package>ul{
          list-style: none;
          padding: 0 0 0 10px;
      }
      #symbol-index .package .nicknames{
          font-weight: normal;
      }
      #symbol-index .package h4{
          display: inline-block;
          margin: 0;
      }
      #symbol-index .package article{
          margin: 0 0 15px 0;
      }
      #symbol-index .package article header{
          font-size: 1.2em;
          font-weight: normal;
      }
      #symbol-index .package .name{
          margin-right: 5px;
      }
      #symbol-index .package .docstring{
          margin: 0 0 0 15px;
          white-space: pre-wrap;
          font-size: 12pt;
      }
      @media (max-width: 800px){
          body{font-size: 12pt;}
      } </style> </head> <body> <header> <h1>lichat-protocol</h1> <span class="version">1.0</span> <p class="description">The independent protocol part of Lichat.</p> </header> <main> <article id="documentation">  <div><h2>About Lichat-Protocol</h2> <p>This system specifies and implements the protocol of the Lichat chat system. It offers both verbal and programmatical descriptions of the protocol. If you are working with a Common Lisp system, you can use this system straight-away to process Lichat messages.</p> <h2>Protocol Specification</h2> <h3>1. Wire Format</h3> <p>The wire format is based on UTF-8 character streams on which objects are serialised in a secure, simplified s-expression format. The format is as follows:</p> <pre><code>WIREABLE ::= OBJECT | STRING | SYMBOL | NUMBER
OBJECT   ::= '(' SYMBOL (<a href="http://l1sp.org/cl/keyword">KEYWORD</a> EXPR)* ')'
EXPR     ::= STRING | LIST | SYMBOL | NUMBER
STRING   ::= '&quot;' ('\' '&quot;' | !'&quot;')* '&quot;'
LIST     ::= '(' EXPR* ')'
SYMBOL   ::= KEYWORD | '#' ':' NAME | NAME ':' NAME
KEYWORD  ::= ':' NAME
NUMBER   ::= '0..9'+ ( '.' '0..9'*)? | '.' '0..9'*
NAME     ::= (('\' TERMINAL) | !TERMINAL)+
TERMINAL ::= ('0..9' | ':' | ' ' | '&quot;' | '.' | '(' | ')')</code></pre> <p>Special care must be taken when reading and printing symbols. Symbols that come from the <code>lichat-protocol</code> package must be printed without the package name prefix. Symbols from the <code><a href="http://l1sp.org/cl/keyword">keyword</a></code> package must be printed by their name only prefixed by a <code>:</code>. Symbols without a package must be printed by their name only and prefixed by a <code>#:</code>. Every other symbol must be prefixed by the symbol's package's name followed by a <code>:</code>. When a symbol is read, it is checked whether it exists in the corresponding package laid out by the previous rules. If it does not exist, the expression is not valid and an error must be generated, but only after the expression has been read to completion.</p> <p>Only Common Lisp objects of type <code><a href="#LICHAT-PROTOCOL:WIREABLE">wireable</a></code> can be serialised to the wire format. Special care must also be taken when <code><a href="#LICHAT-PROTOCOL:WIRE-OBJECT">wire-object</a></code>s are read from the wire. An error must be generated if the object is malformed by either a non-symbol in the first place of its list, imbalanced key/value pairs in the tail, or non-keywords in the key position. An error must also be generated if the symbol at the first position does not name a class that is a subclass of <code><a href="#LICHAT-PROTOCOL:WIRE-OBJECT">wire-object</a></code>. If it is a subclass of <code><a href="#LICHAT-PROTOCOL:UPDATE">update</a></code>, the keys (and values) named <code>:id</code> and <code>:clock</code> must also be present, lest an error be generated.</p> <p>See <code><a href="#LICHAT-PROTOCOL:TO-WIRE">to-wire</a></code>, <code><a href="#LICHAT-PROTOCOL:FROM-WIRE">from-wire</a></code>.</p> <h3>2. Server Objects</h3> <p>The server must keep track of a number of objects that are related to the current state of the chat system. The client may also keep track of some of these objects for its own convenience.</p> <h4>2.1 Connection</h4> <p>Each client is connected to the server through a <code><a href="#LICHAT-PROTOCOL:CONNECTION">connection</a></code> object. Each connection in turn is tied to a user object. A user may have up to an implementation-dependant number of connections at the same time.</p> <h4>2.2 User</h4> <p><code><a href="#LICHAT-PROTOCOL:USER">user</a></code>s represent participants on the chat network. A user has a globally unique name and a number of connections that can act as the user. Each user can be active in a number of channels, the maximal number of which is implementation-dependant. A user must always inhabit the primary channel. A user may have a profile object associated with it. When such a profile exists, the user is considered to be &quot;registered.&quot; The server itself must also have an associated user object, the name of which is up to the specific server instance.</p> <h4>2.3 Profile</h4> <p>The <code><a href="#LICHAT-PROTOCOL:PROFILE">profile</a></code> primarily exists to allow end-users to log in to a user through a password and thus secure the username from being taken by others. A profile has a maximal lifetime. If the user associated with the profile has not been used for longer than the profile's lifetime, the profile is deleted.</p> <h4>2.4 Channel</h4> <p><code><a href="#LICHAT-PROTOCOL:CHANNEL">channel</a></code>s represent communication channels for users over which they can send messages to each other. A channel has a set of permission rules that constrain what kind of updates may be performed on the channel by whom. There are three types of channels that only differ in their naming scheme and their permissions:</p> <ul> <li><strong>primary channels</strong> -- Exactly one of these must exist on any server, and it must be named the same as the server's user. All users that are currently connected to the server must inhabit this channel. The channel may not be used for sending messages by anyone except for system administrators or the server itself. The primary channel is also used for updates that are &quot;channel-less,&quot; to check them for permissions.</li> <li><strong>anonymous channels</strong> -- Anonymous channels must have a random name that is prefixed with an <code>@</code>. Their permissions must prevent users that are not already part of the channel from sending <code><a href="#LICHAT-PROTOCOL:JOIN">join</a></code>, <code><a href="#LICHAT-PROTOCOL:CHANNELS">channels</a></code>, <code><a href="#LICHAT-PROTOCOL:USERS">users</a></code>, or any other kind of update to it, thus essentially making it invisible safe for specially invited users.</li> <li><strong>regular channels</strong> -- Any other channel is considered a &quot;regular channel&quot;.</li> </ul> <h4>2.5 Permission Rules</h4> <p>A permission rule specifies the restrictions of an update type on who is allowed to perform the update on the channel. The structure is as follows:</p> <pre><code>RULE     ::= (<a href="http://l1sp.org/cl/type">type</a> EXPR*)
EXPR     ::= COMPOUND | username | t | nil
COMPOUND ::= (<a href="http://l1sp.org/cl/not">not</a> EXPR) | (<a href="http://l1sp.org/cl/or">or</a> EXPR*) | (<a href="http://l1sp.org/cl/and">and</a> EXPR*)</code></pre> <p>Where <code><a href="http://l1sp.org/cl/type">type</a></code> is the name of an update class, and <code><a href="#LICHAT-PROTOCOL:USERNAME">username</a></code> is the name of a user object. <code>t</code> represents &quot;anyone&quot; and <code>nil</code> represents &quot;no one&quot;. The compound operators combine the expressions logically as sensible. The expressions within the rule are combined as by an <code><a href="http://l1sp.org/cl/or">or</a></code> compound.</p> <h3>3. General Interaction</h3> <p>The client and the server communicate through <code><a href="#LICHAT-PROTOCOL:UPDATE">update</a></code> objects over a connection. Each such object that is issued from the client must contain a unique <code><a href="#LICHAT-PROTOCOL:ID">id</a></code>. This is important as the ID is reused by the server in order to communicate replies. The client can then compare the ID of the incoming updates to find the response to an earlier request, as responses may be reordered or delayed. The server does not check the ID in any way-- uniqueness and avoidance of clashing is the responsibility of the client. Each update must also contain a <code><a href="#LICHAT-PROTOCOL:CLOCK">clock</a></code> slot that specifies the time of sending. This is used to calculate latency and potential connection problems.</p> <p>When an update is sent to a channel, it is distributed to all the users currently in the channel. When an update is sent to a user, it is distributed to all the connections of the user. When an update is sent to a connection, it is serialised to the wire according to the above wire format specification. The actual underlying mechanism that transfers the characters of the wire format to the remote host is implementation-dependant.</p> <h3>4 Connection</h3> <h4>4.1 Establishment</h4> <p>After the connection between a client and a server has been established through some implementation-dependant means, the client must send a <code><a href="#LICHAT-PROTOCOL:CONNECT">connect</a></code> update. The update will attempt to register the user on the server, as follows:</p> <ol> <li>If the update's <code><a href="#LICHAT-PROTOCOL:VERSION">version</a></code> denotes a version that is not compatible to the version of the protocol on the server, an <code><a href="#LICHAT-PROTOCOL:INCOMPATIBLE-VERSION">incompatible-version</a></code> update is returned and the connection is closed.</li> <li>If the update's <code><a href="#LICHAT-PROTOCOL:FROM">from</a></code> field contains an invalid name, a <code><a href="#LICHAT-PROTOCOL:BAD-NAME">bad-name</a></code> update is returned and the connection is closed.</li> <li>If the update does not contain a <code><a href="#LICHAT-PROTOCOL:PASSWORD">password</a></code>, and the <code><a href="#LICHAT-PROTOCOL:FROM">from</a></code> field denotes a username that is already taken by an active user or a registered user, an <code><a href="#LICHAT-PROTOCOL:USERNAME-TAKEN">username-taken</a></code> update is returned and the connection is closed.</li> <li>If the update does contain a <code><a href="#LICHAT-PROTOCOL:PASSWORD">password</a></code>, and the <code><a href="#LICHAT-PROTOCOL:FROM">from</a></code> field denotes a username that is not registered, a <code><a href="#LICHAT-PROTOCOL:NO-SUCH-PROFILE">no-such-profile</a></code> update is returned and the connection is closed.</li> <li>If the update does contain a <code><a href="#LICHAT-PROTOCOL:PASSWORD">password</a></code>, and the <code><a href="#LICHAT-PROTOCOL:FROM">from</a></code> field denotes a username that is registered, but whose password does not match the given one, an <code><a href="#LICHAT-PROTOCOL:INVALID-PASSWORD">invalid-password</a></code> update is returned and the connection is closed.</li> <li>A user corresponding in name to the <code><a href="#LICHAT-PROTOCOL:FROM">from</a></code> field is created if it does not yet exist.</li> <li>The connection is tied to its corresponding user object.</li> <li>The server responds with a <code><a href="#LICHAT-PROTOCOL:CONNECT">connect</a></code> update of the same id as the one the client sent. The <code><a href="#LICHAT-PROTOCOL:FROM">from</a></code> field must correspond to the server's user object's name.</li> <li>If the user already existed, the server responds with <code><a href="#LICHAT-PROTOCOL:JOIN">join</a></code> updates for each of the channels the user is currently inhabiting.</li> <li>If the user did not already exist, it is joined to the primary channel.</li> </ol> <h4>4.2 Connection Maintenance</h4> <p>If the <code><a href="#LICHAT-PROTOCOL:CLOCK">clock</a></code> of an update diverges too much from the one known by the server, the server may drop the connection after replying with a <code><a href="#LICHAT-PROTOCOL:CONNECTION-UNSTABLE">connection-unstable</a></code> update.</p> <p>The server must receive an update on a connection within at least a certain implementation-dependant interval that must be larger than 100 seconds. If this does not happen, the server may assume a disconnection and drop the client after replying with a <code><a href="#LICHAT-PROTOCOL:CONNECTION-UNSTABLE">connection-unstable</a></code> update. If the server does not receive an update from the client within an interval of up to 60 seconds, the server must send a <code><a href="#LICHAT-PROTOCOL:PING">ping</a></code> update to the client, to which the client must respond with a <code><a href="#LICHAT-PROTOCOL:PONG">pong</a></code> update. This is to ensure the stability of the connection.</p> <p>If the client sends too many updates in too short a time interval, the server may start dropping updates, as long as it responds with a <code><a href="#LICHAT-PROTOCOL:TOO-MANY-UPDATES">too-many-updates</a></code> update when it starts doing so. This throttling may be sustained for an implementation-dependant length of time. The client might send occasional <code><a href="#LICHAT-PROTOCOL:PING">ping</a></code> requests to figure out if the throttling has been lifted. The server may also close the connection if it deems the flooding too severe.</p> <h4>4.3 Connection Closure</h4> <p>A connection may be closed either due to a <code><a href="#LICHAT-PROTOCOL:DISCONNECT">disconnect</a></code> update request from the client, or due to problems on the server side. When the connection is closed, the server must act as follows:</p> <ol> <li>The server responds with a <code><a href="#LICHAT-PROTOCOL:DISCONNECT">disconnect</a></code> update, if it still can.</li> <li>The underlying connection between the client and the server is closed.</li> <li>The connection object is removed from the associated user object.</li> <li>If the user does not have any remaining connections, the user leaves all channels it inhabited.</li> </ol> <p>The exceptional situation being during connection establishment. If the server decides to close the connection then, it may do so without responding with a <code><a href="#LICHAT-PROTOCOL:DISCONNECT">disconnect</a></code> update and may immediately close the underlying connection.</p> <h3>5. Client Interaction</h3> <h4>5.1 General Update Checks</h4> <p>An update is always checked as follows:</p> <ol> <li>If the update is not at all recognisable and cannot be parsed, a <code><a href="#LICHAT-PROTOCOL:MALFORMED-UPDATE">malformed-update</a></code> update is sent back and the request is dropped.</li> <li>If the class of the update is not known or not a subclass of <code><a href="#LICHAT-PROTOCOL:WIRE-OBJECT">wire-object</a></code>, an <code><a href="#LICHAT-PROTOCOL:INVALID-UPDATE">invalid-update</a></code> update is sent back and the request is dropped.</li> <li>If the <code><a href="#LICHAT-PROTOCOL:FROM">from</a></code>, <code><a href="#LICHAT-PROTOCOL:CHANNEL">channel</a></code>, or <code><a href="#LICHAT-PROTOCOL:TARGET">target</a></code> fields contain an invalid name, a <code><a href="#LICHAT-PROTOCOL:BAD-NAME">bad-name</a></code> update is sent back and the request is dropped.</li> <li>If the <code><a href="#LICHAT-PROTOCOL:FROM">from</a></code> field does not match the name known to the server by the user associated to the connection, a <code><a href="#LICHAT-PROTOCOL:USERNAME-MISMATCH">username-mismatch</a></code> update is sent back and the request is dropped.</li> <li>If the <code><a href="#LICHAT-PROTOCOL:CHANNEL">channel</a></code> field denotes a channel that does not exist, but must, a <code><a href="#LICHAT-PROTOCOL:NO-SUCH-CHANNEL">no-such-channel</a></code> update is sent back and the request is dropped.</li> <li>If the <code><a href="#LICHAT-PROTOCOL:TARGET">target</a></code> field denotes a user that does not exist, a <code><a href="#LICHAT-PROTOCOL:NO-SUCH-USER">no-such-user</a></code> update is sent back and the request is dropped.</li> <li>If the update is an operation that is not permitted on its target channel, or the primary channel if no target channel is applicable, an <code><a href="#LICHAT-PROTOCOL:INSUFFICIENT-PERMISSIONS">insufficient-permissions</a></code> update is sent back and the request is dropped.</li> </ol> <h4>5.2 Profile Registration</h4> <p>When a user sends a <code><a href="#LICHAT-PROTOCOL:REGISTER">register</a></code> update, the server must act as follows:</p> <ol> <li>If a profile of the same name as the user does not already exist, the profile is created.</li> <li>The password of the profile associated to the user is changed to match the one from the update.</li> <li>The profile must stay live until at least 365 days after the user associated with the profile has existed on the server.</li> </ol> <p>Note that the server does not need to store the password verbatim, and is instead advised to only store and compare a hash of it.</p> <h4>5.3 Channel Creation &amp; Management</h4> <p>Since a channel has only two bits of information associated with it, the management of channels is rather simple. Creating a new channel happens with the <code><a href="#LICHAT-PROTOCOL:CREATE">create</a></code> update:</p> <ol> <li>The update is checked for permissions by the primary channel.</li> <li>If a channel of the <code><a href="#LICHAT-PROTOCOL:CHANNEL">channel</a></code> name in the update already exists, the server responds with a <code><a href="#LICHAT-PROTOCOL:CHANNELNAME-TAKEN">channelname-taken</a></code> update and drops the request.</li> <li>If the <code><a href="#LICHAT-PROTOCOL:CHANNEL">channel</a></code> field is <code>NIL</code>, an anonymous channel is created, otherwise a regular channel is created.</li> <li>The user is automatically joined to the channel.</li> <li>The server responds with a <code><a href="#LICHAT-PROTOCOL:JOIN">join</a></code> update to the user with the <code><a href="#LICHAT-PROTOCOL:ID">id</a></code> being the same as the id of the create update.</li> </ol> <p>From there on out the channel's permissions can be viewed or changed with the <code><a href="#LICHAT-PROTOCOL:PERMISSIONS">permissions</a></code> update, if the channel allows you to do so. Note that the server must only update the channel's permissions, if the update's <code><a href="#LICHAT-PROTOCOL:PERMISSIONS">permissions</a></code> field is not <code>NIL</code>.</p> <p>See <a href="#permission-rules">Permission Rules</a> for an explanation of the proper syntax of the permissions.</p> <h4>5.4 Channel Interaction</h4> <p>A user can interact with a channel in several ways. </p> <h5>5.4.1 Joining a Channel</h5> <p>Joining a channel happens with the <code><a href="#LICHAT-PROTOCOL:JOIN">join</a></code> update, after which the server acts as follows:</p> <ol> <li>If the user is already in the named channel, an <code><a href="#LICHAT-PROTOCOL:ALREADY-IN-CHANNEL">already-in-channel</a></code> update is sent back and the request is dropped.</li> <li>The user is added to the channel's list of users.</li> <li>The user's <code><a href="#LICHAT-PROTOCOL:JOIN">join</a></code> update is distributed to all users in the channel.</li> </ol> <h5>5.4.2 Leaving a Channel</h5> <p>Leaving a channel again happens with the <code><a href="#LICHAT-PROTOCOL:LEAVE">leave</a></code> update, after which the server acts as follows:</p> <ol> <li>If the user is not in the named channel, a <code><a href="#LICHAT-PROTOCOL:NOT-IN-CHANNEL">not-in-channel</a></code> update is sent back and the request is dropped.</li> <li>The user's <code><a href="#LICHAT-PROTOCOL:LEAVE">leave</a></code> update is distributed to all users in the channel.</li> <li>The user is removed from the channel's list of users.</li> </ol> <h5>5.4.3 Pulling a User</h5> <p>Another user can be pulled into the channel by the <code><a href="#LICHAT-PROTOCOL:PULL">pull</a></code> update, after which the server acts as follows:</p> <ol> <li>If the user is not in the named channel, a <code><a href="#LICHAT-PROTOCOL:NOT-IN-CHANNEL">not-in-channel</a></code> update is sent back and the request is dropped.</li> <li>If the target user is already in the named channel, an <code><a href="#LICHAT-PROTOCOL:ALREADY-IN-CHANNEL">already-in-channel</a></code> update is sent back and the request is dropped.</li> <li>The target user is added to the channel's list of users.</li> <li>A <code><a href="#LICHAT-PROTOCOL:JOIN">join</a></code> update for the target user with the same <code><a href="#LICHAT-PROTOCOL:ID">id</a></code> as the <code><a href="#LICHAT-PROTOCOL:PULL">pull</a></code> update is distributed to all users in the channel.</li> </ol> <h5>5.4.4 Kicking a User</h5> <p>Another user can be kicked from a channel by the <code><a href="#LICHAT-PROTOCOL:KICK">kick</a></code> update, after which the server acts as follows:</p> <ol> <li>If the user is not in the named channel, a <code><a href="#LICHAT-PROTOCOL:NOT-IN-CHANNEL">not-in-channel</a></code> update is sent back and the request is dropped.</li> <li>If the target user is not in the named channel, a <code><a href="#LICHAT-PROTOCOL:NOT-IN-CHANNEL">not-in-channel</a></code> update is sent back and the request is dropped.</li> <li>The user's <code><a href="#LICHAT-PROTOCOL:KICK">kick</a></code> update is distributed to all users in the channel.</li> <li>A <code><a href="#LICHAT-PROTOCOL:LEAVE">leave</a></code> update for the target user is distributed to all users in the channel.</li> <li>The target user is removed from the channel's list of users.</li> </ol> <h5>5.4.5 Sending a Message</h5> <p>Finally, a user can send a message to all other users in a channel with the <code><a href="#LICHAT-PROTOCOL:MESSAGE">message</a></code> update, after which the server acts as follows:</p> <ol> <li>If the user is not in the named channel, a <code><a href="#LICHAT-PROTOCOL:NOT-IN-CHANNEL">not-in-channel</a></code> update is sent back and the request is dropped.</li> <li>The user's <code><a href="#LICHAT-PROTOCOL:MESSAGE">message</a></code> update is distributed to all users in the channel.</li> </ol> <h4>5.5 Server Information Retrieval</h4> <p>The server can provide a client with several pieces of information about its current state. </p> <h5>5.5.1 Listing Public Channels</h5> <p>Retrieving a list of channels can be done with the <code><a href="#LICHAT-PROTOCOL:CHANNELS">channels</a></code> update, after which the server acts as follows:</p> <ol> <li>For each channel known to the server, the server checks the update against the channel's permissions.</li> <li>If the permissions allow the update, the channel's name is recorded.</li> <li>A <code><a href="#LICHAT-PROTOCOL:CHANNELS">channels</a></code> update with the same <code><a href="#LICHAT-PROTOCOL:ID">id</a></code> as the request is sent back with the <code><a href="#LICHAT-PROTOCOL:CHANNELS">channels</a></code> field set to the list of names of channels that were recorded.</li> </ol> <h5>5.5.2 Listing All Users of a Channel</h5> <p>The list of users currently in a channel can be retrieved by the <code><a href="#LICHAT-PROTOCOL:USERS">users</a></code> update, after which the server acts as follows:</p> <ol> <li>A list of the users in the channel is recorded.</li> <li>A <code><a href="#LICHAT-PROTOCOL:USERS">users</a></code> update with the same <code><a href="#LICHAT-PROTOCOL:ID">id</a></code> as the request is sent back with the <code><a href="#LICHAT-PROTOCOL:USERS">users</a></code> field set to the list of names of users that were recorded.</li> </ol> <h5>5.5.3 Requesting Information About a User</h5> <p>Finally, information about a particular user can be retrieved by the <code><a href="#LICHAT-PROTOCOL:USER-INFO">user-info</a></code> update, after which the server acts as follows:</p> <ol> <li>A <code><a href="#LICHAT-PROTOCOL:USER-INFO">user-info</a></code> update with the same <code><a href="#LICHAT-PROTOCOL:ID">id</a></code> as the request is sent back with the <code><a href="#LICHAT-PROTOCOL:CONNECTIONS">connections</a></code> field set to the number of connections the user object has associated with it and with the <code><a href="#LICHAT-PROTOCOL:REGISTERED">registered</a></code> field set to <code>T</code> if the user has a profile associated with it.</li> </ol> <h2>See Also</h2> <ol> <li><a href="https://shirakumo.org/projects/lichat-serverlib">lichat-serverlib</a> An agnostic implementation of the server-side protocol.</li> <li><a href="https://shirakumo.org/projects/lichat-tcp-server">lichat-tcp-server</a> A basic, threaded, TCP-based implementation of a Lichat server.</li> <li><a href="https://shirakumo.org/projects/lichat-tcp-client">lichat-tcp-client</a> A basic, threaded, TCP-based implementation of a Lichat client.</li> </ol> </div>  </article> <article id="copyright">  <h2>Copyright</h2> <span>lichat-protocol</span> is licensed under the <span><a href="https://tldrlegal.com/search?q=Artistic">Artistic</a></span> license.  © <span>Nicolas Hafner &lt;shinmera@tymoon.eu&gt;</span> .  This library can be obtained on <a href="https://github.com/Shinmera/lichat">https://github.com/Shinmera/lichat</a>.  </article>  <article id="symbol-index"> <h2>Package Index</h2> <ul><li class="package"> <h3> <a name="LICHAT-PROTOCOL" href="#LICHAT-PROTOCOL">LICHAT-PROTOCOL</a> <span class="nicknames">(ORG.SHIRAKUMO.LICHAT.PROTOCOL)</span> </h3> <ul><li> <a name="LICHAT-PROTOCOL:*DEFAULT-ANONYMOUS-CHANNEL-PERMISSIONS*"> </a> <article> <header class="special"> <span class="type">special</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:*DEFAULT-ANONYMOUS-CHANNEL-PERMISSIONS*">*DEFAULT-ANONYMOUS-CHANNEL-PERMISSIONS*</a></code></h4>  </header> <pre class="docstring">Default permissions for anonymous channels.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:*DEFAULT-CHANNEL-LIFETIME*"> </a> <article> <header class="special"> <span class="type">special</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:*DEFAULT-CHANNEL-LIFETIME*">*DEFAULT-CHANNEL-LIFETIME*</a></code></h4>  </header> <pre class="docstring">The default lifetime for a new channel in seconds.

Should equal to one standard month (30 days).</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:*DEFAULT-PRIMARY-CHANNEL-PERMISSIONS*"> </a> <article> <header class="special"> <span class="type">special</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:*DEFAULT-PRIMARY-CHANNEL-PERMISSIONS*">*DEFAULT-PRIMARY-CHANNEL-PERMISSIONS*</a></code></h4>  </header> <pre class="docstring">Default permissions for primary/server channels.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:*DEFAULT-PROFILE-LIFETIME*"> </a> <article> <header class="special"> <span class="type">special</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:*DEFAULT-PROFILE-LIFETIME*">*DEFAULT-PROFILE-LIFETIME*</a></code></h4>  </header> <pre class="docstring">The default lifetime for a registered profile in seconds.

Should equal to one non-leap year.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:*DEFAULT-REGULAR-CHANNEL-PERMISSIONS*"> </a> <article> <header class="special"> <span class="type">special</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:*DEFAULT-REGULAR-CHANNEL-PERMISSIONS*">*DEFAULT-REGULAR-CHANNEL-PERMISSIONS*</a></code></h4>  </header> <pre class="docstring">Default permissions for non-primary, non-anonymous channels.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:*ID-COUNTER*"> </a> <article> <header class="special"> <span class="type">special</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:*ID-COUNTER*">*ID-COUNTER*</a></code></h4>  </header> <pre class="docstring">Counter variables for update IDs.

Starts at a random integer between 0 and the current universal-time.
This is done to make the clashing of IDs less likely to occur between
users of the protocol library.

See NEXT-ID</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:ALREADY-IN-CHANNEL"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:ALREADY-IN-CHANNEL">ALREADY-IN-CHANNEL</a></code></h4>  </header> <pre class="docstring">Update in response to a JOIN/PULL request for a user that is already in the specified channel.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:BAD-NAME"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:BAD-NAME">BAD-NAME</a></code></h4>  </header> <pre class="docstring">Update in response to any named request with a name that is not valid.

Relevant are the FROM, TARGET, and CHANNEL fields.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:CHANNEL"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:CHANNEL">CHANNEL</a></code></h4>  </header> <pre class="docstring">Class to represent a channel.

See NAMED-OBJECT
See SERVER-OBJECT
See PERMISSIONS
See LIFETIME
See USERS
See *DEFAULT-CHANNEL-LIFETIME*</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:CHANNEL-UPDATE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:CHANNEL-UPDATE">CHANNEL-UPDATE</a></code></h4>  </header> <pre class="docstring">Superclass for all updates relating to a channel.

See CHANNEL
See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:CHANNELNAME-TAKEN"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:CHANNELNAME-TAKEN">CHANNELNAME-TAKEN</a></code></h4>  </header> <pre class="docstring">Update in response to a CREATE request for a channel that already exists.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:CHANNELS"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:CHANNELS">CHANNELS</a></code></h4>  </header> <pre class="docstring">Update to represent a channels listing request.

Possible responses:
CHANNELS
BAD-NAME
USERNAME-MISMATCH

See CHANNELS
See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:CONNECT"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:CONNECT">CONNECT</a></code></h4>  </header> <pre class="docstring">Update to represent a connection request.

This update must be the first thing sent by the client upon
connection establishment.

Possible responses:
CONNECT
BAD-NAME
INVALID-PASSWORD
USERNAME-TAKEN
NO-SUCH-PROFILE
INCOMPATIBLE-VERSION

See PASSWORD
See VERSION
See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:CONNECTION"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:CONNECTION">CONNECTION</a></code></h4>  </header> <pre class="docstring"/> </article> </li><li> <a name="LICHAT-PROTOCOL:CONNECTION-UNSTABLE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:CONNECTION-UNSTABLE">CONNECTION-UNSTABLE</a></code></h4>  </header> <pre class="docstring">Update in response to an unstable or slow connection.

See FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:CREATE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:CREATE">CREATE</a></code></h4>  </header> <pre class="docstring">Update to represent a channel creation request.

The channel may be NIL, in which case an anonymous channel
is constructed. You can obtain the name of the anonymous
channel by reading it out of the JOIN response.

Possible responses:
JOIN
BAD-NAME
USERNAME-MISMATCH
CHANNELNAME-TAKEN
BAD-NAME
INSUFFICIENT-PERMISSIONS

See CHANNEL-UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:DISCONNECT"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:DISCONNECT">DISCONNECT</a></code></h4>  </header> <pre class="docstring">Update to represent a disconnection request.

Possible responses:
DISCONNECT
USERNAME-MISMATCH

See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:FAILURE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:FAILURE">FAILURE</a></code></h4>  </header> <pre class="docstring">Superclass for all failure response updates.

See TEXT-UDPATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:INCOMPATIBLE-VERSION"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:INCOMPATIBLE-VERSION">INCOMPATIBLE-VERSION</a></code></h4>  </header> <pre class="docstring">Update in response to a connection attempt with an incompatible protocol version.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:INSUFFICIENT-PERMISSIONS"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:INSUFFICIENT-PERMISSIONS">INSUFFICIENT-PERMISSIONS</a></code></h4>  </header> <pre class="docstring">Update in response to a request that is not permitted on the current or primary channel.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:INVALID-PASSWORD"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:INVALID-PASSWORD">INVALID-PASSWORD</a></code></h4>  </header> <pre class="docstring">Update in response to a connection attempt with an invalid password for the profile.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:INVALID-PERMISSIONS"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:INVALID-PERMISSIONS">INVALID-PERMISSIONS</a></code></h4>  </header> <pre class="docstring">Update in response to a PERMISSIONS request that attempted to set malformed permissions.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:INVALID-UPDATE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:INVALID-UPDATE">INVALID-UPDATE</a></code></h4>  </header> <pre class="docstring">Update in response to an update of invalid type.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:JOIN"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:JOIN">JOIN</a></code></h4>  </header> <pre class="docstring">Update to represent a channel join request.

Possible responses:
JOIN
BAD-NAME
USERNAME-MISMATCH
ALREADY-IN-CHANNEL
NO-SUCH-CHANNEL
INSUFFICIENT-PERMISSIONS

See CHANNEL-UDPATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:KICK"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:KICK">KICK</a></code></h4>  </header> <pre class="docstring">Update to represent a user kick request.

Possible responses:
KICK
BAD-NAME
USERNAME-MISMATCH
NOT-IN-CHANNEL
NO-SUCH-USER
NO-SUCH-CHANNEL
INSUFFICIENT-PERMISSIONS

See TARGET-UPDATE
See CHANNEL-UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:LEAVE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:LEAVE">LEAVE</a></code></h4>  </header> <pre class="docstring">Update to represent a channel leave request.

Possible responses:
LEAVE
BAD-NAME
USERNAME-MISMATCH
NOT-IN-CHANNEL
NO-SUCH-CHANNEL
INSUFFICIENT-PERMISSIONS

See CHANNEL-UDPATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:MALFORMED-UPDATE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:MALFORMED-UPDATE">MALFORMED-UPDATE</a></code></h4>  </header> <pre class="docstring">Update in response to a malformed update.

See FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:MESSAGE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:MESSAGE">MESSAGE</a></code></h4>  </header> <pre class="docstring">Update to represent a channel message request.

Possible responses:
MESSAGE
BAD-NAME
USERNAME-MISMATCH
NO-SUCH-CHANNEL
INSUFFICIENT-PERMISSIONS

See CHANNEL-UPDATE
See TEXT-UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:NAMED-OBJECT"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:NAMED-OBJECT">NAMED-OBJECT</a></code></h4>  </header> <pre class="docstring">Superclass for all objects that are named.

See NAME</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:NO-SUCH-CHANNEL"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:NO-SUCH-CHANNEL">NO-SUCH-CHANNEL</a></code></h4>  </header> <pre class="docstring">Update in response to a CHANNEL-UPDATE for a channel that does not exist.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:NO-SUCH-PROFILE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:NO-SUCH-PROFILE">NO-SUCH-PROFILE</a></code></h4>  </header> <pre class="docstring">Update in response to a connection attempt with a password for an inexistent profile.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:NO-SUCH-USER"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:NO-SUCH-USER">NO-SUCH-USER</a></code></h4>  </header> <pre class="docstring">Update in response to a TARGET-UPDATE request that refers to user that does not exist.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:NOT-IN-CHANNEL"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:NOT-IN-CHANNEL">NOT-IN-CHANNEL</a></code></h4>  </header> <pre class="docstring">Update in response to a LEAVE/KICK request for a user that is not in the specified channel.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PERMISSIONS"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:PERMISSIONS">PERMISSIONS</a></code></h4>  </header> <pre class="docstring">Update to represent a channel permissions view or change request.

If PERMISSIONS is NIL, the permissions are not changed.

Possible responses:
PERMISSIONS
BAD-NAME
USERNAME-MISMATCH
NO-SUCH-CHANNEL
INSUFFICIENT-PERMISSIONS

See PERMISSIONS
See CHANNEL-UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PING"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:PING">PING</a></code></h4>  </header> <pre class="docstring">Update to represent a ping request.

The recipient must reply with a PONG update.

Possible responses:
PONG

See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PONG"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:PONG">PONG</a></code></h4>  </header> <pre class="docstring">Update to represent a pong response.

See PING
See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PROFILE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:PROFILE">PROFILE</a></code></h4>  </header> <pre class="docstring">Class to represent user profiles. Only registered users have a profile.

See NAMED-OBJECT
See SERVER-OBJECT
See NAME
See PASSWORD
See LIFETIME
See *DEFAULT-PROFILE-LIFETIME*</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PULL"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:PULL">PULL</a></code></h4>  </header> <pre class="docstring">Update to represent a user pull request.

The user will be automatically joined to the channel.

Possible responses:
JOIN
BAD-NAME
USERNAME-MISMATCH
ALREADY-IN-CHANNEL
NO-SUCH-USER
NO-SUCH-CHANNEL
INSUFFICIENT-PERMISSIONS

See TARGET-UPDATE
See CHANNEL-UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:REGISTER"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:REGISTER">REGISTER</a></code></h4>  </header> <pre class="docstring">Update to represent a registration request.

Possible responses:
REGISTER
BAD-NAME
USERNAME-MISMATCH
INSUFFICIENT-PERMISSIONS

See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:SERVER-OBJECT"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:SERVER-OBJECT">SERVER-OBJECT</a></code></h4>  </header> <pre class="docstring">Superclass for all objects that exist on the server-side.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:TARGET-UPDATE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:TARGET-UPDATE">TARGET-UPDATE</a></code></h4>  </header> <pre class="docstring">Superclass for all updates that target a user.

See TARGET
See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:TEXT-UPDATE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:TEXT-UPDATE">TEXT-UPDATE</a></code></h4>  </header> <pre class="docstring">Superclass for all updates that carry a text string.

See TEXT
See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:TOO-MANY-UPDATES"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:TOO-MANY-UPDATES">TOO-MANY-UPDATES</a></code></h4>  </header> <pre class="docstring">Update in response to a flooding of the server.

When this update is sent, any number of future updates
that are received may be dropped instead.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:UPDATE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:UPDATE">UPDATE</a></code></h4>  </header> <pre class="docstring">Base class for all updates.

See WIRE-OBJECT
See ID
See CLOCK
See FROM
See NEXT-ID</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:UPDATE-FAILURE"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:UPDATE-FAILURE">UPDATE-FAILURE</a></code></h4>  </header> <pre class="docstring">Update in response to an update request that failed.

See UPDATE-ID</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:USER"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:USER">USER</a></code></h4>  </header> <pre class="docstring">Class to represent a user. Anything that can communicate with the server must have a user obuject.


See NAMED-OBJECT
See SERVER-OBJECT
See CONNECTIONS
See CHANNELS</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:USER-INFO"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:USER-INFO">USER-INFO</a></code></h4>  </header> <pre class="docstring">Update to represent a user information request.

Possible responses:
USER-INFO
BAD-NAME
USERNAME-MISMATCH
NO-SUCH-USER

See REGISTERED
See CONNECTIONS
See TARGET-UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:USERNAME-MISMATCH"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:USERNAME-MISMATCH">USERNAME-MISMATCH</a></code></h4>  </header> <pre class="docstring">Update in response to a mismatch between the known username and the one in the FROM field.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:USERNAME-TAKEN"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:USERNAME-TAKEN">USERNAME-TAKEN</a></code></h4>  </header> <pre class="docstring">Update in response to a connection attempt with a username that is already taken.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:USERS"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:USERS">USERS</a></code></h4>  </header> <pre class="docstring">Update to represent a channel users listing request.

Possible responses:
USERS
BAD-NAME
USERNAME-MISMATCH
NO-SUCH-CHANNEL
INSUFFICIENT-PERMISSIONS

See CHANNEL-UPDATE
See USERS</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:WIRE-OBJECT"> </a> <article> <header class="class"> <span class="type">class</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:WIRE-OBJECT">WIRE-OBJECT</a></code></h4>  </header> <pre class="docstring">Superclass for all classes that can be put onto the wire.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:INCOMPATIBLE-VALUE-TYPE-FOR-SLOT"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:INCOMPATIBLE-VALUE-TYPE-FOR-SLOT">INCOMPATIBLE-VALUE-TYPE-FOR-SLOT</a></code></h4>  </header> <pre class="docstring">Condition signalled when an incompatible type is attempted to be set on a slot.

See OBJECT
See SLOT
See VALUE
See REQTYPE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:INCOMPLETE-TOKEN"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:INCOMPLETE-TOKEN">INCOMPLETE-TOKEN</a></code></h4>  </header> <pre class="docstring">Condition signalled when a token is not complete on the wire and thus can't be read fully.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:MISSING-CLOCK"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:MISSING-CLOCK">MISSING-CLOCK</a></code></h4>  </header> <pre class="docstring">Condition signalled when the CLOCK field is missing from an update.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:MISSING-ID"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:MISSING-ID">MISSING-ID</a></code></h4>  </header> <pre class="docstring">Condition signalled when the ID field is missing from an update.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:MISSING-UPDATE-ARGUMENT"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:MISSING-UPDATE-ARGUMENT">MISSING-UPDATE-ARGUMENT</a></code></h4>  </header> <pre class="docstring">Superclass for all conditions relating to missing required arguments in updates.

See MISSING-ID
See MISSING-CLOCK
See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PRINTER-CONDITION"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:PRINTER-CONDITION">PRINTER-CONDITION</a></code></h4>  </header> <pre class="docstring">Superclass for all conditions relating to printing to the wire.

See UNPRINTABLE-OBJECT</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PROTOCOL-CONDITION"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:PROTOCOL-CONDITION">PROTOCOL-CONDITION</a></code></h4>  </header> <pre class="docstring">Superclass for all conditions relating to the protocol.

See WIRE-CONDITION
See INCOMPATIBLE-VALUE-TYPE-FOR-SLOT</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:READER-CONDITION"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:READER-CONDITION">READER-CONDITION</a></code></h4>  </header> <pre class="docstring">Superclass for all conditions relating to reading from the wire.

See INCOMPLETE-TOKEN
See UNKNOWN-SYMBOL</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:UNKNOWN-SYMBOL"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:UNKNOWN-SYMBOL">UNKNOWN-SYMBOL</a></code></h4>  </header> <pre class="docstring">Condition signalled when an unknown symbol is found on the wire.

See SYMBOL-DESIGNATOR</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:UNKNOWN-WIRE-OBJECT"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:UNKNOWN-WIRE-OBJECT">UNKNOWN-WIRE-OBJECT</a></code></h4>  </header> <pre class="docstring">Condition signalled when an object is found on the wire that has an unknown type.

See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:UNPRINTABLE-OBJECT"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:UNPRINTABLE-OBJECT">UNPRINTABLE-OBJECT</a></code></h4>  </header> <pre class="docstring">Condition signalled when an unprintable object is attempted to be put onto the wire.

See OBJECT</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:WIRE-CONDITION"> </a> <article> <header class="condition"> <span class="type">condition</span>  <h4 class="name"><code><a href="#LICHAT-PROTOCOL:WIRE-CONDITION">WIRE-CONDITION</a></code></h4>  </header> <pre class="docstring">Superclass for all conditions relating to the wire format.

See PRINTER-CONDITION
See READER-CONDITION
See MISSING-UPDATE-ARGUMENT
See UNKNOWN-WIRE-OBJECT
See MALFORMED-WIRE-OBJECT</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:CHANNEL"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:CHANNEL">CHANNEL</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring"/> </article> </li><li> <a name="LICHAT-PROTOCOL:CHANNELS"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:CHANNELS">CHANNELS</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the list of channels of the object.

See USER
See CHANNELS</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:CLOCK"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:CLOCK">CLOCK</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the clock of the update.

Must be a universal-time timestamp set at the time the update
was constructed.

See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:CONNECTIONS"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:CONNECTIONS">CONNECTIONS</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the list of connections of the user or count of connections of the user-info.

See USER
See USER-INFO</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:FROM"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:FROM">FROM</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the sender of the update.

Must be a username string identifying the user that sent it.

See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:HOSTNAME"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:HOSTNAME">HOSTNAME</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the hostname of the connection.

See CONNECTION</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:ID"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:ID">ID</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the ID of the update.

IDs should be connection-unique, meaning the same ID should not
appear on different connections at the same time.

See UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:LIFETIME"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:LIFETIME">LIFETIME</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the lifetime of the object.

The object should stay alive for at least this many
seconds after it has ceased to be used.

See PROFILE
See CHANNEL</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:NAME"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:NAME">NAME</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the object's name string.

See NAMED-OBJECT</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PASSWORD"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:PASSWORD">PASSWORD</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the password of the object.

See PROFILE
See REGISTER
See CONNECT</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PERMISSIONS"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:PERMISSIONS">PERMISSIONS</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the permissions list of the object.

See CHANNEL
See PERMISSIONS</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PORT"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:PORT">PORT</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the port of the connection.

See CONNECTION</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:REGISTERED"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:REGISTERED">REGISTERED</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to whether the user is registered or not.

See USER-INFO</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:TARGET"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:TARGET">TARGET</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the name of the user being targeted.

See TARGET-UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:TEXT"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:TEXT">TEXT</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the text string carried by the update.

See TEXT-UPDATE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:UPDATE-ID"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:UPDATE-ID">UPDATE-ID</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the ID of the update that failed to be completed.

See UPDATE-FAILURE</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:USER"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:USER">USER</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the user tied to the connection.

See CONNECTION
See USER</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:USERS"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:USERS">USERS</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the list of users of the object.

See CHANNEL
See USERS</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:VERSION"> </a> <article> <header class="accessor"> <span class="type">accessor</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:VERSION">VERSION</a></code></h4> <code class="qualifiers"></code> <code class="arguments">OBJECT</code><code>)</code>  </header> <pre class="docstring">Accessor to the version of the connection update.

See CONNECT</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:CHANNELNAME-P"> </a> <article> <header class="function"> <span class="type">function</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:CHANNELNAME-P">CHANNELNAME-P</a></code></h4> <code class="qualifiers"></code> <code class="arguments">NAME</code><code>)</code>  </header> <pre class="docstring">Returns true if the given name is a valid name for channels.

That is to say, the name must be a string in [1,32] of length.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:FROM-WIRE"> </a> <article> <header class="function"> <span class="type">function</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:FROM-WIRE">FROM-WIRE</a></code></h4> <code class="qualifiers"></code> <code class="arguments">STREAM</code><code>)</code>  </header> <pre class="docstring">Read a wire object from the stream.

First an object is read from stream by READ-SEXPR.
If the returned object is not a cons, it is returned
immediately. Otherwise, the procedure is as follows:
The first element must be a symbol. If it isn't, an
error of type MALFORMED-WIRE-OBJECT is signalled.
If the symbol does not designate a class, or designates
a class that is not a subclass of WIRE-OBJECT, an error
of type UNKNOWN-WIRE-OBJECT is signalled. If the class
is a subclass of UPDATE, the rest of the items in the
list are checked as follows: they must be balanced
pairs of KEYWORD to atom. If this is not the case, an
error of type MALFORMED-WIRE-OBJECT is signalled. If
no key :ID is found, an error of type MISSING-ID is
signalled. If no key :CLOCK is found, an error of type
MISSING-CLOCK is signalled. Finally MAKE-INSTANCE is
called with the full expression as arguments. If the
class is a subclass of wire-object, MAKE-INSTANCE is
called with the full expression as arguments immediately.

See READ-SEXPR
See UNKNOWN-WIRE-OBJECT
See MISSING-ID
See MISSING-CLOCK
See UNKNOWN-WIRE-OBJECT</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:ID-P"> </a> <article> <header class="function"> <span class="type">function</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:ID-P">ID-P</a></code></h4> <code class="qualifiers"></code> <code class="arguments">ID</code><code>)</code>  </header> <pre class="docstring">Returns true if the given object is a valid ID.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:NEXT-ID"> </a> <article> <header class="function"> <span class="type">function</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:NEXT-ID">NEXT-ID</a></code></h4> <code class="qualifiers"></code> <code class="arguments"></code><code>)</code>  </header> <pre class="docstring">Returns a fresh ID.

See *ID-COUNTER*</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PASSWORD-P"> </a> <article> <header class="function"> <span class="type">function</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:PASSWORD-P">PASSWORD-P</a></code></h4> <code class="qualifiers"></code> <code class="arguments">PASS</code><code>)</code>  </header> <pre class="docstring">Returns true if the given object is a string of at least six characters.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:PROTOCOL-VERSION"> </a> <article> <header class="function"> <span class="type">function</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:PROTOCOL-VERSION">PROTOCOL-VERSION</a></code></h4> <code class="qualifiers"></code> <code class="arguments"></code><code>)</code>  </header> <pre class="docstring">Returns the version string for the protocol.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:TO-WIRE"> </a> <article> <header class="function"> <span class="type">function</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:TO-WIRE">TO-WIRE</a></code></h4> <code class="qualifiers"></code> <code class="arguments">WIREABLE STREAM</code><code>)</code>  </header> <pre class="docstring">Print the wireable object to the stream.

Only handles objects of type WIRE-OBJECT and WIREABLE.

WIRE-OBJECTS are printed as a list in the following
format: a list of the object's type symbol followed by
pairs of keyword to value of the object's slots that
have an initarg. Slots without an initarg are not
printed.

The output is forced once written fully.

See PRINT-SEXPR
See FORCE-OUTPUT</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:USERNAME-P"> </a> <article> <header class="function"> <span class="type">function</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:USERNAME-P">USERNAME-P</a></code></h4> <code class="qualifiers"></code> <code class="arguments">NAME</code><code>)</code>  </header> <pre class="docstring">Returns true if the given name is a valid name for users.

That is to say, the name must be a string in [1,32] of length.</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:WHITESPACE-P"> </a> <article> <header class="function"> <span class="type">function</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:WHITESPACE-P">WHITESPACE-P</a></code></h4> <code class="qualifiers"></code> <code class="arguments">CHAR</code><code>)</code>  </header> <pre class="docstring">Returns T if the character is considered to be whitespace.

See *WHITESPACE*</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:OBJECT"> </a> <article> <header class="generic"> <span class="type">generic</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:OBJECT">OBJECT</a></code></h4> <code class="qualifiers"></code> <code class="arguments">CONDITION</code><code>)</code>  </header> <pre class="docstring">The object related to the condition.

See UNPRINTABLE-OBJECT
See INCOMPATIBLE-VALUE-TYPE-FOR-SLOT</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:SYMBOL-DESIGNATOR"> </a> <article> <header class="generic"> <span class="type">generic</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:SYMBOL-DESIGNATOR">SYMBOL-DESIGNATOR</a></code></h4> <code class="qualifiers"></code> <code class="arguments">CONDITION</code><code>)</code>  </header> <pre class="docstring">The symbol designator for the unknown symbol that was found on the wire.

Returns a CONS of two strings for the package- and symbol-name respectively.

See UNKNOWN-SYMBOL</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:UPDATE"> </a> <article> <header class="generic"> <span class="type">generic</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:UPDATE">UPDATE</a></code></h4> <code class="qualifiers"></code> <code class="arguments">CONDITION</code><code>)</code>  </header> <pre class="docstring">The update object that relates to the condition.

See MISSING-UPDATE-ARGUMENT
See UNKNOWN-WIRE-OBJECT</pre> </article> </li><li> <a name="LICHAT-PROTOCOL:DEFINE-PROTOCOL-CLASS"> </a> <article> <header class="macro"> <span class="type">macro</span>  <code>(</code><h4 class="name"><code><a href="#LICHAT-PROTOCOL:DEFINE-PROTOCOL-CLASS">DEFINE-PROTOCOL-CLASS</a></code></h4> <code class="qualifiers"></code> <code class="arguments">&amp;REST ARGS</code><code>)</code>  </header> <pre class="docstring">Defines a new protocol class.

See DEFINE-TYPED-CLASS</pre> </article> </li></ul> </li></ul> </article>  </main> </body> </html> 